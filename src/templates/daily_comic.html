{% extends "base.html" %}

{% block title %}Generate Daily News Comics{% endblock %}

{% block header %}Generate Daily News Comics{% endblock %}

{% block content %}
    <form id="daily-comic-form" method="POST">
        <div class="form-group">
            <label for="location">Enter a location:</label>
            <input type="text" id="location" name="location" required>
            <button type="submit" class="btn">Generate Comic</button>
        </div>
    </form>
    <div id="result-container"></div>
{% endblock %}

{% block extra_scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        var form = document.getElementById('daily-comic-form');
        form.addEventListener('submit', function(e) {
            e.preventDefault();
            var formData = new FormData(form);

            showProgress('Generating daily comics...');
            document.querySelector('input').disabled = true;
            document.querySelector('button').disabled = true;
            document.getElementById('result-container').innerHTML = '';

            fetch(form.action, {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                hideProgress();
                document.querySelector('input').disabled = false;
                document.querySelector('button').disabled = false;
                if (data.success) {
                    document.getElementById('result-container').innerHTML = data.html;
                } else {
                    document.getElementById('result-container').innerHTML = '<p class="message message-error">' + data.message + '</p>';
                }
            })
            .catch(error => {
                hideProgress();
                document.querySelector('input').disabled = false;
                document.querySelector('button').disabled = false;
                document.getElementById('result-container').innerHTML = '<p class="message message-error">An error occurred. Please try again.</p>';
                console.error('Error:', error);
            });
        });
    });
</script>
{% endblock %}